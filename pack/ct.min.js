(()=>{var t={609:()=>{self.fetch||(self.fetch=function(t,e){return e=e||{},new Promise((function(n,r){var i=new XMLHttpRequest,s=[],o={},a=function t(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:t,headers:{keys:function(){return s},entries:function(){return s.map((function(t){return[t,i.getResponseHeader(t)]}))},get:function(t){return i.getResponseHeader(t)},has:function(t){return null!=i.getResponseHeader(t)}}}};for(var c in i.open(e.method||"get",t,!0),i.onload=function(){i.getAllResponseHeaders().toLowerCase().replace(/^(.+?):/gm,(function(t,e){o[e]||s.push(o[e]=e)})),n(a())},i.onerror=r,i.withCredentials="include"==e.credentials,e.headers)i.setRequestHeader(c,e.headers[c]);i.send(e.body||null)}))})}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,n),s.exports}(()=>{"use strict";n(609);var t=Object.defineProperty,e=(e,n,r)=>(((e,n,r)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r})(e,"symbol"!=typeof n?n+"":n,r),r);class r{constructor(t,n){e(this,"result"),e(this,"loading"),e(this,"token"),e(this,"fallbackError"),e(this,"cacheKey"),this.token=t,this.fallbackError=n,this.cacheKey=`ct:checkin:${this.token}`}clear(){return this.loading=!1,this.result=void 0,this}send(t){return e=this,null,n=function*(){this.loading=!0;try{if(this.result)return this.result;const e=`https://api.staging.atendesimples.com/call-tracking/check-in/2/${this.token}`,n={method:"POST",body:JSON.stringify(t),headers:{"x-as-key":this.token,"Content-type":"application/json"}};let r=yield fetch(e,n);if(r.status>422)return this.result={type:"error",number:this.fallbackError},this.result;let i=yield r.json();return this.result=i,this.loading=!1,i}catch(t){return this.result={type:"error",number:this.fallbackError},this.result}finally{this.loading=!1}},new Promise(((t,r)=>{var i=t=>{try{o(n.next(t))}catch(t){r(t)}},s=t=>{try{o(n.throw(t))}catch(t){r(t)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,s);o((n=n.apply(e,null)).next())}));var e,n}}class i{static call(t){return e=this,n=arguments,r=function*({token:t,number:e}){return fetch(`https://api.staging.atendesimples.com/call-tracking/checkout/${t}/${e}`,{method:"POST",keepalive:!0,headers:{"x-as-key":t,"Content-type":"application/json"}})},new Promise(((t,i)=>{var s=t=>{try{a(r.next(t))}catch(t){i(t)}},o=t=>{try{a(r.throw(t))}catch(t){i(t)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,o);a((r=r.apply(e,n)).next())}));var e,n,r}}var s=Object.defineProperty,o=(t,e,n)=>(((t,e,n)=>{e in t?s(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const a=new class{constructor(){o(this,"success"),o(this,"response")}call(t){return e=this,n=arguments,r=function*({token:t,visitor:e,number:n}){try{const r=`https://api.staging.atendesimples.com/call-tracking/ping/${e}/${n}`,i={method:"POST",headers:{"x-as-key":t,"Content-type":"application/json"}};let s=yield fetch(r,i);return this.success=200==s.status,this.response=yield s.json(),this}catch(t){return this}},new Promise(((t,i)=>{var s=t=>{try{a(r.next(t))}catch(t){i(t)}},o=t=>{try{a(r.throw(t))}catch(t){i(t)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,o);a((r=r.apply(e,n)).next())}));var e,n,r}};function c(t){let e={},n={};for(var r in t)n[r]=t[r];return Object.keys(n).forEach((function(n,r){t[n]&&(e[n]=t[n],sessionStorage.setItem(n,t[n]))})),e}function l(t){let e={};for(var n in t)e[n]=t[n];let r=function(t){return localStorage.getItem(t)||void 0};return{properties:e,first:function(){let t={};return Object.keys(e).forEach((function(n,i){r(n)||localStorage.setItem(n,e[n]),t[n]=r(n)})),t},latest:function(){let t={};return Object.keys(e).forEach((function(n,i){localStorage.setItem(n,e[n]),t[n]=r(n)})),t}}}const u={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let h;const m=new Uint8Array(16);function d(){if(!h&&(h="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!h))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(m)}const f=[];for(let t=0;t<256;++t)f.push((t+256).toString(16).slice(1));const p=function(t,e,n){if(u.randomUUID&&!e&&!t)return u.randomUUID();const r=(t=t||{}).random||(t.rng||d)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=r[t];return e}return function(t,e=0){return(f[t[e+0]]+f[t[e+1]]+f[t[e+2]]+f[t[e+3]]+"-"+f[t[e+4]]+f[t[e+5]]+"-"+f[t[e+6]]+f[t[e+7]]+"-"+f[t[e+8]]+f[t[e+9]]+"-"+f[t[e+10]]+f[t[e+11]]+f[t[e+12]]+f[t[e+13]]+f[t[e+14]]+f[t[e+15]]).toLowerCase()}(r)};class g{static get(t){return document.querySelector(t)}static updateValue(t,e){let n=this.get(t);return n.textContent=e,n}static cid(){let t=document.cookie.split(";").find((t=>t.match(/_ga=(.+?)/)));return t?t.split(".").slice(-2).join("."):""}}function y(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?null:decodeURIComponent(e[1].replace(/\+/g," "))}function b(t){return sessionStorage.getItem(t)?sessionStorage.getItem(t):y(t)?y(t):null}function k(t,e=""){return localStorage.getItem(t)?localStorage.getItem(t):e}function v(t,e="no_utm"){return b(t)?b(t):e||"no_utm"}function _(){return g.cid()||"no_cid"}function w(){return location.protocol?location.protocol+"//"+location.hostname+location.pathname:""}function x(){return location.search||""}function I(){return document.referrer||"direto"}const S={QueryStringSession:c,Context:l,Analytics:class{static createSessionByQueryString(){return c({utm_source:v("utm_source"),utm_medium:v("utm_medium"),utm_campaign:v("utm_campaign"),utm_id:v("utm_campaignid"),utm_term:v("utm_term"),utm_content:v("utm_content"),last_referrer:b("last_referrer")||I(),last_page:b("last_page")||w(),last_querystring:b("last_querystring")||x()})}static fixed(){let t=l({utm_source:v("utm_source"),utm_medium:v("utm_medium"),utm_campaign:v("utm_campaign"),utm_id:v("utm_campaignid"),utm_term:v("utm_term"),utm_content:v("utm_content"),referrer:I(),page:w(),querystring:x(),cid:_(),date:(new Date).toISOString(),fingerprint:k("fingerprint",p())}),e=t.first();return{context:t,attributes:e}}static latest(){let t=l({last_utm_source:v("utm_source"),last_utm_medium:v("utm_medium"),last_utm_campaign:v("utm_campaign"),last_utm_id:v("utm_campaignid"),last_utm_term:v("utm_term"),last_utm_content:v("utm_content"),last_referrer:b("last_referrer")||I(),last_page:b("last_page")||w(),last_querystring:b("last_querystring")||x(),last_cid:_(),last_convert_page:location.href}),e=t.latest();return{context:t,attributes:e}}static call(){return this.createSessionByQueryString(),{fixed:this.fixed(),latest:this.latest()}}}};var C=Object.defineProperty,T=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,E=(t,e,n)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,O=(t,e)=>{for(var n in e||(e={}))P.call(e,n)&&E(t,n,e[n]);if(T)for(var n of T(e))R.call(e,n)&&E(t,n,e[n]);return t},j=(t,e,n)=>(E(t,"symbol"!=typeof e?e+"":e,n),n),A=(t,e,n)=>new Promise(((r,i)=>{var s=t=>{try{a(n.next(t))}catch(t){i(t)}},o=t=>{try{a(n.throw(t))}catch(t){i(t)}},a=t=>t.done?r(t.value):Promise.resolve(t.value).then(s,o);a((n=n.apply(t,e)).next())}));class N extends HTMLElement{constructor(){super(),j(this,"number"),j(this,"checkin"),j(this,"shadow"),j(this,"token"),j(this,"eventType"),j(this,"fallbackErrorNumber"),j(this,"utm"),j(this,"visitorID"),j(this,"checkinSendProps"),j(this,"elementRef"),j(this,"pingTimer"),this.shadow=this.attachShadow({mode:"open"}),this.elementRef=document.createElement("div"),this.token=this.getAttribute("token"),this.eventType=this.getAttribute("event-type"),this.fallbackErrorNumber=this.getAttribute("fallback-error"),this.elementRef.textContent="","click"==this.eventType&&(this.elementRef.textContent="click pra ver");let t=S.Analytics.call();this.utm=O(O({},t.fixed.attributes),t.latest.attributes),this.visitorID=this.utm.fingerprint,this.checkin=new r(this.token,this.fallbackErrorNumber),this.checkinSendProps={utm:this.utm,visitor_id:this.visitorID,visitor_user_agent:navigator.userAgent||"no_ua",cid:_(),date:(new Date).toISOString()},document.head.createShadowRoot||document.head.attachShadow,this.shadow.appendChild(this.elementRef)}pingPong(){return A(this,null,(function*(){const t={token:this.token,visitor:this.visitorID,number:this.checkin.result.number};return yield a.call(t)}))}checkIfNumberIsAvailable(t){return A(this,null,(function*(){if(!this.checkin.loading){if(t=t||0,clearInterval(this.pingTimer),t>=3)return console.log("CallTracking checkin was fail"),this.elementRef.textContent=this.fallbackErrorNumber,!1;this.checkin.clear(),yield this.checkin.send(this.checkinSendProps),this.elementRef.textContent=this.checkin.result.number,t=0,"pool"==this.checkin.result.type&&(this.pingTimer=setInterval((()=>A(this,null,(function*(){if(!(yield this.pingPong()).success)return this.elementRef.textContent="",t++,this.checkIfNumberIsAvailable(t)}))),1e4))}}))}notifyCallTrackingCheckout(){return A(this,null,(function*(){return clearInterval(this.pingTimer),this.checkin&&(i.call({token:this.token,number:this.checkin.result.number}),this.checkin.clear()),this.elementRef.textContent="",!0}))}connectedCallback(){return A(this,null,(function*(){console.log("CallTracking element added to page."),"click"==this.eventType?this.elementRef.addEventListener("click",(()=>A(this,null,(function*(){this.elementRef.textContent="-",yield this.checkIfNumberIsAvailable()})))):yield this.checkIfNumberIsAvailable(),document.addEventListener("visibilitychange",(()=>A(this,null,(function*(){if(null==document.visibilityState||"visible"===document.visibilityState)return"load"==this.eventType&&(yield this.checkIfNumberIsAvailable()),!0;setTimeout((()=>{"visible"!==document.visibilityState&&this.notifyCallTrackingCheckout()}),100)})))),window.addEventListener("beforeunload",(()=>(console.log("CallTracking beforeunload invoked"),this.notifyCallTrackingCheckout(),!0))),window.addEventListener("online",(t=>{"load"==this.eventType&&this.checkIfNumberIsAvailable()})),window.addEventListener("offline",(t=>{console.log("CallTracking is now offline"),this.notifyCallTrackingCheckout(),this.elementRef.textContent=this.fallbackErrorNumber}))}))}disconnectedCallback(){return A(this,null,(function*(){yield this.notifyCallTrackingCheckout()}))}}window.customElements.define("call-tracking",N)})()})();